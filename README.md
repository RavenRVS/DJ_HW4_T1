# Миграции

## Задание <a href="#doc">(Мое решение)</a> 

Есть страница сайта школы.
При создании был не верно выбран тип связи `многие к одному`.
И теперь у ученика есть только один учитель и чтобы добавить к нему второго, требуется
заново добавлять ученика в базу.

Необходимо поменять модели и сделать отношение `многие ко многим` между Учителями и Учащимися.
Это решит проблемы текущей архитектуры.

Задача:

1. Поменять отношения моделей `Student` и `Teacher` с `Foreign key` на `Many to many`
2. Поправить шаблон списка учеников с учетом изменения моделей

## Примечание

Сначала примените текущую миграцию, затем загрузите исходные данные с помощью `loaddata` и после этого меняйте модели и делайте новые миграции.

В противном случае `loaddata` не сможет загрузить данные на новую схемы и данные придется заносить вручную.


## Дополнительное задание

Проанализируйте число sql-запросов (напоминание: для этого можно использовать `django-debug-toolbar`) Для каждого студента будет выполняться отдельный запрос. Это не очень производительное решение - улучшите его с помощью `prefetch_related` ([документация](https://docs.djangoproject.com/en/3.2/ref/models/querysets/#prefetch-related)).

<a name="doc"></a>

## Документация по проекту

Для запуска проекта необходимо:

#### Установить зависимости:

```bash
pip install -r requirements.txt
```

#### Создать базу данных в соответствии с настройками в файле <a href="https://github.com/RavenRVS/DJ_HW4_T1/blob/master/website/settings.py">settings.py</a> или заменить настройки базы данных на свои.

#### Выполнить миграции. Провести миграцию:

```bash
python manage.py migrate
```

#### Загрузить тестовые данные:

***ВАЖНО***: после изменения моделей и применения миграций загрузить данные не получится! Выполните загрузку данных **ДО** изменения моделей.

```bash
python manage.py loaddata school.json
```

Если все же изменили модели, но не загрузили тестовые данные - ничего страшного, можно создать тестовые данные самостоятельно в админке.

#### Запустить отладочный веб-сервер проекта:

```bash
python manage.py runserver
```
